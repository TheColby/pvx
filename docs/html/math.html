<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>pvx Mathematical Foundations</title>
  <link rel="stylesheet" href="style.css" />
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <h1>pvx Mathematical Foundations</h1>
      <nav><a href="index.html">Home</a> | <a href="papers.html">Research papers</a> | <a href="glossary.html">Technical glossary</a> | <a href="windows.html">Window reference</a> | <a href="benchmarks.html">Benchmarks</a></nav>
    </div>
  </header>
  <main class="wrap">
<div class="card">
  <p>
    Mathematical summary of the core signal-processing model used across pvx.
    Equations are rendered with MathJax when this page is opened in a normal browser.
  </p>
  <p class="small">
    GitHub usually displays HTML source text. For GitHub-native math rendering, use
    <a href="../MATHEMATICAL_FOUNDATIONS.md"><code>docs/MATHEMATICAL_FOUNDATIONS.md</code></a>.
  </p>
</div>


<div class="card">
  <h2>STFT Analysis and Synthesis</h2>
  <p><strong>Analysis:</strong></p>
  <p>$$X_t[k]=\sum_{n=0}^{N-1} x[n+tH_a]w[n]e^{-j2\pi kn/N}$$</p>
  <p class="small">Each frame $t$ is windowed by $w[n]$ and transformed to complex bins $k$.</p>
  <p><strong>Synthesis:</strong></p>
  <p>$$\hat{x}[n]=\frac{\sum_t \hat{x}_t[n-tH_s]w[n-tH_s]}{\sum_t w^2[n-tH_s]+\varepsilon}$$</p>
  <p class="small">Overlap-add with energy normalization preserves level stability.</p>
</div>


<div class="card">
  <h2>Transform Backend Selection (<code>--transform</code>)</h2>
  <p>
    pvx lets you choose the per-frame transform backend used in analysis/resynthesis:
    <code>fft</code>, <code>dft</code>, <code>czt</code>, <code>dct</code>, <code>dst</code>, and <code>hartley</code>.
  </p>
  <p><strong>Fourier family (<code>fft</code>, <code>dft</code>):</strong></p>
  <p>$$X_t[k]=\sum_{n=0}^{N-1} x_t[n]e^{-j2\pi kn/N},\qquad x_t[n]=\frac{1}{N}\sum_{k=0}^{N-1}X_t[k]e^{j2\pi kn/N}$$</p>
  <p><strong>Chirp-Z (<code>czt</code>):</strong> $$X_t[k]=\sum_{n=0}^{N-1}x_t[n]A^{-n}W^{nk}$$</p>
  <p class="small">With pvx defaults $A=1$ and $W=e^{-j2\pi/N}$, CZT samples the DFT contour via a different numerical path.</p>
  <p><strong>DCT-II (<code>dct</code>):</strong> $$C_t[k]=\alpha_k\sum_{n=0}^{N-1}x_t[n]\cos\left(\frac{\pi}{N}(n+\tfrac{1}{2})k\right)$$</p>
  <p><strong>DST-II (<code>dst</code>):</strong> $$S_t[k]=\beta_k\sum_{n=0}^{N-1}x_t[n]\sin\left(\frac{\pi}{N}(n+\tfrac{1}{2})(k+1)\right)$$</p>
  <p><strong>Hartley (<code>hartley</code>):</strong> $$H_t[k]=\sum_{n=0}^{N-1}x_t[n]\,\mathrm{cas}\left(\frac{2\pi kn}{N}\right),\ \mathrm{cas}(\theta)=\cos\theta+\sin\theta$$</p>

  <table>
    <thead>
      <tr>
        <th>Transform</th>
        <th>Why use it</th>
        <th>Tradeoffs</th>
        <th>Example use case</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>fft</code></td>
        <td>Fastest and most robust default; best runtime and CUDA support.</td>
        <td>Typical STFT leakage/time-resolution tradeoffs still apply.</td>
        <td>General production stretch/pitch workflows.</td>
      </tr>
      <tr>
        <td><code>dft</code></td>
        <td>Reference Fourier baseline for transform parity checks.</td>
        <td>Usually slower than <code>fft</code> with little audible benefit.</td>
        <td>Verification and algorithm A/B testing.</td>
      </tr>
      <tr>
        <td><code>czt</code></td>
        <td>Alternative numerical path for awkward or prime frame sizes.</td>
        <td>Requires SciPy; generally slower and CPU-oriented.</td>
        <td>Edge-case frame-size validation and diagnostics.</td>
      </tr>
      <tr>
        <td><code>dct</code></td>
        <td>Real-basis energy compaction, useful for envelope-focused shaping.</td>
        <td>No explicit complex phase bins; less transparent for strict phase coherence.</td>
        <td>Creative timbre shaping and coefficient-domain experiments.</td>
      </tr>
      <tr>
        <td><code>dst</code></td>
        <td>Odd-symmetry real-basis alternative with distinct coloration.</td>
        <td>Same phase limitations as DCT; artifacts are content-dependent.</td>
        <td>Experimental percussive/spectral texture variants.</td>
      </tr>
      <tr>
        <td><code>hartley</code></td>
        <td>Real transform with Fourier-related basis for exploratory comparisons.</td>
        <td>Different bin semantics from complex STFT can change artifact character.</td>
        <td>Pedagogical and creative real-domain phase-vocoder tests.</td>
      </tr>
    </tbody>
  </table>

  <h3>Sample use cases</h3>
  <pre><code>python3 pvxvoc.py dialog.wav --transform fft --time-stretch 1.08 --transient-preserve --output-dir out
python3 pvxvoc.py tone_sweep.wav --transform dft --time-stretch 1.00 --output-dir out
python3 pvxvoc.py archival_take.wav --transform czt --n-fft 1531 --win-length 1531 --hop-size 382 --output-dir out
python3 pvxvoc.py strings.wav --transform dct --pitch-shift-cents -17 --output-dir out
python3 pvxvoc.py percussion.wav --transform dst --time-stretch 0.92 --phase-locking off --output-dir out
python3 pvxvoc.py synth_pad.wav --transform hartley --time-stretch 1.30 --output-dir out</code></pre>
</div>


<div class="card">
  <h2>Phase-Vocoder Propagation</h2>
  <p>$$\Delta\phi_t[k]=\mathrm{princarg}\Big(\phi_t[k]-\phi_{t-1}[k]-\omega_kH_a\Big)$$</p>
  <p>$$\hat{\omega}_t[k]=\omega_k+\frac{\Delta\phi_t[k]}{H_a}$$</p>
  <p>$$\hat{\phi}_t[k]=\hat{\phi}_{t-1}[k]+\hat{\omega}_t[k]H_s$$</p>
  <p class="small">
    pvx uses these relationships to estimate true instantaneous frequency and
    re-accumulate phase under a new synthesis hop.
  </p>
</div>


<div class="card">
  <h2>Pitch and Microtonal Mapping</h2>
  <p>$$r_{\text{pitch}}=2^{\Delta s/12}=2^{\Delta c/1200}$$</p>
  <p class="small">
    Semitone shift $\Delta s$ and cents shift $\Delta c$ are equivalent ratio controls.
    Scale-constrained retuning maps detected F0 to the nearest permitted scale target.
  </p>
</div>


<div class="card">
  <h2>Dynamics and Loudness</h2>
  <p>$$g_{\text{LUFS}}=10^{(L_{\text{target}}-L_{\text{in}})/20}$$</p>
  <p>$$y[n]=x[n]\cdot g_{\text{LUFS}}$$</p>
  <p class="small">
    Target-loudness gain is applied in linear amplitude domain after dynamics stages,
    before limiting/clipping safety stages.
  </p>
</div>


<div class="card">
  <h2>Spatial and Multichannel Highlights</h2>
  <p><strong>Delay-and-sum beamforming:</strong> $$y[n]=\frac{1}{M}\sum_{m=1}^{M}x_m[n-\tau_m]$$</p>
  <p><strong>MVDR weights:</strong> $$\mathbf{w}=\frac{\mathbf{R}^{-1}\mathbf{d}}{\mathbf{d}^H\mathbf{R}^{-1}\mathbf{d}}$$</p>
  <p><strong>FOA encode (WXYZ):</strong> $$W=\frac{s}{\sqrt{2}},\ X=s\cos\theta\cos\varphi,\ Y=s\sin\theta\cos\varphi,\ Z=s\sin\varphi$$</p>
  <p class="small">
    pvx spatial modules combine beamforming, ambisonic transformations, and phase-vocoder-consistent
    multichannel processing for robust chain composition.
  </p>
</div>
</main>
  <footer class="site-footer">
    <div class="wrap">
      Generated by <code>scripts_generate_html_docs.py</code> from commit <code>39eeaf2</code>
      (commit date: 2026-02-17T14:18:07-05:00).
    </div>
  </footer>
</body>
</html>
