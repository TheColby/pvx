# Changelog

## 2026-02-19

- Stage 3 (pipeline ergonomics + output policy hardening) implemented:
  - added shared output-policy core module:
    - `/Users/cleider/dev/pvx/src/pvx/core/output_policy.py`
  - added deterministic output policy flags across audio-output tools:
    - `--bit-depth {inherit,16,24,32f}`
    - `--dither {none,tpdf}` and `--dither-seed`
    - `--true-peak-max-dbtp`
    - `--metadata-policy {none,sidecar,copy}`
    - retained explicit override `--subtype`
  - integrated output-policy processing into:
    - shared writer path `/Users/cleider/dev/pvx/src/pvx/core/common.py`
    - `pvx voc` write path `/Users/cleider/dev/pvx/src/pvx/core/voc.py`
  - added metadata sidecar emission (`*.metadata.json`) for reproducible output metadata.
  - added helper workflows in unified CLI:
    - `pvx chain` (managed multi-stage serial tool chains)
    - `pvx stream` now defaults to a stateful chunk engine with continuity context (`--mode stateful`)
    - legacy segmented behavior remains available via `pvx stream --mode wrapper`
  - updated non-`voc` tool writers to propagate source input metadata when sidecars are enabled.
  - added/updated tests:
    - `/Users/cleider/dev/pvx/tests/test_output_policy.py`
    - `/Users/cleider/dev/pvx/tests/test_cli_regression.py`
  - updated docs:
    - `/Users/cleider/dev/pvx/README.md`
    - `/Users/cleider/dev/pvx/docs/GETTING_STARTED.md`
    - `/Users/cleider/dev/pvx/docs/EXAMPLES.md`
    - `/Users/cleider/dev/pvx/docs/QUALITY_GUIDE.md`

- Stage 2 (quality validation + determinism) implemented:
  - expanded benchmark reproducibility controls in `/Users/cleider/dev/pvx/benchmarks/run_bench.py`:
    - corpus manifest support (`--dataset-manifest`, `--refresh-manifest`, `--strict-corpus`)
    - deterministic CPU mode controls (`--deterministic-cpu`, `--no-deterministic-cpu`)
    - repeated determinism checks (`--determinism-runs`)
    - output signature capture and baseline signature gating (`--gate-signatures`)
    - row-level regression gating (`--gate-row-level`)
  - added multi-metric directional gate rules beyond the original 4-metric gate.
  - added automatic quality diagnostics in benchmark JSON/Markdown reports with remediation hints.
  - added corpus hash manifest `/Users/cleider/dev/pvx/benchmarks/data/manifest.json`.
  - updated quick baseline to include row metrics and deterministic signatures:
    - `/Users/cleider/dev/pvx/benchmarks/baseline_small.json`
  - updated CI benchmark gate workflow:
    - `/Users/cleider/dev/pvx/.github/workflows/bench-regression.yml`
  - added benchmark Stage 2 unit coverage in:
    - `/Users/cleider/dev/pvx/tests/test_benchmark_runner.py`
  - refreshed benchmark docs:
    - `/Users/cleider/dev/pvx/docs/BENCHMARKS.md`

- Added unified `pvx` CLI entrypoint:
  - new module `/Users/cleider/dev/pvx/src/pvx/cli/pvx.py`
  - new root compatibility wrapper `/Users/cleider/dev/pvx/pvx.py`
  - new package script in `/Users/cleider/dev/pvx/pyproject.toml`: `pvx = "pvx.cli.pvx:main"`
- Unified command dispatch now supports:
  - subcommands for all existing tools (`voc`, `freeze`, `harmonize`, `conform`, `morph`, `warp`, `formant`, `transient`, `unison`, `denoise`, `deverb`, `retune`, `layer`, `pitch-track`)
  - helper commands: `list`, `help`, `examples`, `guided`
  - default shorthand: `pvx <input.wav> ...` automatically routes to `pvx voc ...`
- Replaced legacy `main` navigator with a compatibility bridge to unified `pvx` CLI:
  - `/Users/cleider/dev/pvx/src/pvx/cli/main.py`
- Standardized explicit single-file output support across common CLI tools:
  - added `--output` / `--out` in shared I/O args (`/Users/cleider/dev/pvx/src/pvx/core/common.py`)
  - added validation for `--output` with multi-input/`--output-dir`/`--stdout` combinations
- Updated `pvxvoc` built-in examples/help text to show unified `pvx voc ...` commands.
- Updated beginner-facing docs for Stage 1 UX:
  - `/Users/cleider/dev/pvx/README.md`
  - `/Users/cleider/dev/pvx/docs/GETTING_STARTED.md`
  - `/Users/cleider/dev/pvx/docs/EXAMPLES.md`
- Added CLI regression tests for unified command surface and explicit output path behavior:
  - `/Users/cleider/dev/pvx/tests/test_cli_regression.py`

## 2026-02-18

- Added hybrid transient engine plumbing in `pvxvoc` with new modes:
  - `--transient-mode off|reset|hybrid|wsola`
  - `--transient-sensitivity`
  - `--transient-protect-ms`
  - `--transient-crossfade-ms`
- Added deterministic WSOLA core implementation in `/Users/cleider/dev/pvx/src/pvx/core/wsola.py`.
- Added transient detection/segmentation module in `/Users/cleider/dev/pvx/src/pvx/core/transients.py`.
- Added stereo/multichannel coherence controls:
  - `--stereo-mode independent|mid_side_lock|ref_channel_lock`
  - `--ref-channel`
  - `--coherence-strength`
- Added channel-coherence utilities and objective coherence metrics:
  - `/Users/cleider/dev/pvx/src/pvx/core/stereo.py`
  - `/Users/cleider/dev/pvx/src/pvx/metrics/coherence.py`
- Added intent preset registry in `/Users/cleider/dev/pvx/src/pvx/core/presets.py` with new presets:
  - `default`, `vocal_studio`, `drums_safe`, `extreme_ambient`, `stereo_coherent`
  - legacy presets remain supported (`none`, `vocal`, `ambient`, `extreme`)
- Added benchmark suite:
  - `/Users/cleider/dev/pvx/benchmarks/run_bench.py`
  - `/Users/cleider/dev/pvx/benchmarks/metrics.py`
  - baseline gate file `/Users/cleider/dev/pvx/benchmarks/baseline_small.json`
- Added CI benchmark regression workflow:
  - `/Users/cleider/dev/pvx/.github/workflows/bench-regression.yml`
- Added/updated tests for transient/stereo behavior and new CLI paths.
- Refined CLI help taxonomy with explicit sections:
  - `I/O`, `Performance`, `Quality/Phase`, `Time/Pitch`, `Transients`, `Stereo`, `Output/Mastering`, `Debug`
  - consolidated duplicate `Time/Pitch` blocks into a single grouped section
- Added benchmark metric unit tests in `/Users/cleider/dev/pvx/tests/test_benchmark_metrics.py`.
- Tuned benchmark runner defaults in `/Users/cleider/dev/pvx/benchmarks/run_bench.py`:
  - new `--pvx-bench-profile {tuned,legacy}` switch
  - default `tuned` deterministic profile for stronger cycle-consistency quality metrics
- Expanded benchmark metrics in `/Users/cleider/dev/pvx/benchmarks/metrics.py` and reporting:
  - SNR, SI-SDR, spectral convergence, envelope correlation
  - RMS/crest deltas, bandwidth(95%) delta, ZCR delta, DC delta, clipping-ratio delta
- Updated benchmark gate baseline in `/Users/cleider/dev/pvx/benchmarks/baseline_small.json` to match tuned profile output.
- Added shared audio metrics table module `/Users/cleider/dev/pvx/src/pvx/core/audio_metrics.py`.
- Added non-silent ASCII input/output metrics table printing across pvx CLIs and `pvxvoc`.
- Expanded documentation:
  - `/Users/cleider/dev/pvx/docs/DEV_NOTES.md`
  - `/Users/cleider/dev/pvx/docs/QUALITY_GUIDE.md`
  - `/Users/cleider/dev/pvx/docs/RUBBERBAND_COMPARISON.md`
  - `/Users/cleider/dev/pvx/docs/BENCHMARKS.md`
  - refreshed `/Users/cleider/dev/pvx/README.md`, `/Users/cleider/dev/pvx/docs/GETTING_STARTED.md`, `/Users/cleider/dev/pvx/docs/EXAMPLES.md`
